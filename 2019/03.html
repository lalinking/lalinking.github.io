<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<meta name='keywords' content="js,javascript,省略号">
<meta name='description' content="【Javascript】两行代码实现截取显示（字符宽度计算 + 超过部分显示省略号）">
<meta name='modifydate' content='2019-03-13'>
<title>【Javascript】两行代码实现截取显示（字符宽度计算 + 超过部分显示省略号）</title>
<link href='/style.css' rel='stylesheet' type='text/css' />
<script src='/head.js'></script>
<script src='/nav.js'></script>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h3><a name='header-n8' class='md-header-anchor '></a>功能</h3><p>  CSS 语法 <strong>text-overflow: ellipsis</strong> 兼容性不好，为达到最大兼容可采用 JS 处理。</p><h3><a name='header-n16' class='md-header-anchor '></a>原理</h3><p>  有些字符占用一个字节，有些会占用两个字节，substr时不能根据字节来取下标，可以用正则来截取。</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 36px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 28px; margin-bottom: 0px; border-right-width: 0px; min-width: 848px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28px; width: 28px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">cutstr</span>(<span class="cm-def">str</span>) {</span></pre></div><div class="" style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">let</span> <span class="cm-def">s</span> <span class="cm-operator">=</span> <span class="cm-variable-2">str</span>.<span class="cm-property">replace</span>(<span class="cm-string-2">/^(((\w\w)|(\w)|([^\x00-\xff])){5}).*$/</span>, <span class="cm-string">"$1"</span>);</span></pre></div><div class="" style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable-2">s</span>.<span class="cm-property">length</span> <span class="cm-operator">===</span> <span class="cm-variable-2">str</span>.<span class="cm-property">length</span> <span class="cm-operator">?</span> <span class="cm-variable-2">str</span> : (<span class="cm-variable-2">s</span>.<span class="cm-property">replace</span>(<span class="cm-string-2">/((\w\w)|(\w)|([^\x00-\xff]))$/</span>, <span class="cm-string">""</span>) <span class="cm-operator">+</span> <span class="cm-string">'..'</span>);</span></pre></div><div class="" style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="height: 92px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 27px;"></div></div></div></div></pre><p>&nbsp;</p></div>
</body>
</html>